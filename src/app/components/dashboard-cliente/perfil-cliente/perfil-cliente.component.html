<div class="perfil-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <button class="back-btn" (click)="volver()">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="header-text">
        <h1><i class="fas fa-user-circle"></i> Mi Perfil</h1>
        <p>Gestiona tu información personal</p>
      </div>
    </div>
  </div>

  <!-- Indicador de carga -->
  <div *ngIf="cargando" class="loading-container">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p>Cargando información del perfil...</p>
  </div>

  <!-- Formulario -->
  <div *ngIf="!cargando" class="form-container">
    <form [formGroup]="perfilForm" (ngSubmit)="guardarCambios()">
      
      <!-- Información de Identificación -->
      <div class="form-section">
        <div class="section-header">
          <i class="fas fa-id-card"></i>
          <h2>Información de Identificación</h2>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="numeroDocumento">Número de Documento</label>
            <input 
              type="text" 
              id="numeroDocumento" 
              class="form-control" 
              formControlName="numeroDocumento"
              readonly>
            <small class="form-text text-muted">Este campo no se puede modificar</small>
          </div>

          <div class="form-group">
            <label for="tipoDocumento">Tipo de Documento</label>
            <input 
              type="text" 
              id="tipoDocumento" 
              class="form-control" 
              formControlName="tipoDocumento"
              readonly>
            <small class="form-text text-muted">Este campo no se puede modificar</small>
          </div>
        </div>
      </div>

      <!-- Información Personal -->
      <div class="form-section">
        <div class="section-header">
          <i class="fas fa-user"></i>
          <h2>Información Personal</h2>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="primerNombre">Primer Nombre *</label>
            <input 
              type="text" 
              id="primerNombre" 
              class="form-control" 
              formControlName="primerNombre"
              [class.is-invalid]="primerNombre?.invalid && primerNombre?.touched">
            <div class="invalid-feedback" *ngIf="primerNombre?.invalid && primerNombre?.touched">
              <span *ngIf="primerNombre?.errors?.['required']">El primer nombre es requerido</span>
              <span *ngIf="primerNombre?.errors?.['minlength']">Debe tener al menos 2 caracteres</span>
            </div>
          </div>

          <div class="form-group">
            <label for="segundoNombre">Segundo Nombre</label>
            <input 
              type="text" 
              id="segundoNombre" 
              class="form-control" 
              formControlName="segundoNombre">
          </div>

          <div class="form-group">
            <label for="primerApellido">Primer Apellido *</label>
            <input 
              type="text" 
              id="primerApellido" 
              class="form-control" 
              formControlName="primerApellido"
              [class.is-invalid]="primerApellido?.invalid && primerApellido?.touched">
            <div class="invalid-feedback" *ngIf="primerApellido?.invalid && primerApellido?.touched">
              <span *ngIf="primerApellido?.errors?.['required']">El primer apellido es requerido</span>
              <span *ngIf="primerApellido?.errors?.['minlength']">Debe tener al menos 2 caracteres</span>
            </div>
          </div>

          <div class="form-group">
            <label for="segundoApellido">Segundo Apellido</label>
            <input 
              type="text" 
              id="segundoApellido" 
              class="form-control" 
              formControlName="segundoApellido">
          </div>

          <div class="form-group">
            <label for="fechaNacimiento">Fecha de Nacimiento</label>
            <input 
              type="date" 
              id="fechaNacimiento" 
              class="form-control" 
              formControlName="fechaNacimiento">
          </div>

          <div class="form-group">
            <label for="genero">Género</label>
            <select 
              id="genero" 
              class="form-control" 
              formControlName="genero">
              <option value="">Seleccionar...</option>
              <option *ngFor="let genero of getGeneros()" [value]="genero.valor">
                {{ genero.texto }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="estadoCivil">Estado Civil</label>
            <select 
              id="estadoCivil" 
              class="form-control" 
              formControlName="estadoCivil">
              <option value="">Seleccionar...</option>
              <option *ngFor="let estado of getEstadosCiviles()" [value]="estado">
                {{ estado }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="nacionalidad">Nacionalidad</label>
            <input 
              type="text" 
              id="nacionalidad" 
              class="form-control" 
              formControlName="nacionalidad">
          </div>
        </div>
      </div>

      <!-- Información de Contacto -->
      <div class="form-section">
        <div class="section-header">
          <i class="fas fa-address-book"></i>
          <h2>Información de Contacto</h2>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="correoElectronico">Correo Electrónico *</label>
            <input 
              type="email" 
              id="correoElectronico" 
              class="form-control" 
              formControlName="correoElectronico"
              [class.is-invalid]="correoElectronico?.invalid && correoElectronico?.touched">
            <div class="invalid-feedback" *ngIf="correoElectronico?.invalid && correoElectronico?.touched">
              <span *ngIf="correoElectronico?.errors?.['required']">El correo electrónico es requerido</span>
              <span *ngIf="correoElectronico?.errors?.['email']">Ingrese un correo electrónico válido</span>
            </div>
          </div>

          <div class="form-group">
            <label for="telefono">Teléfono Fijo</label>
            <input 
              type="tel" 
              id="telefono" 
              class="form-control" 
              formControlName="telefono"
              placeholder="Ej: 601234567">
          </div>

          <div class="form-group">
            <label for="celular">Celular *</label>
            <input 
              type="tel" 
              id="celular" 
              class="form-control" 
              formControlName="celular"
              placeholder="Ej: 3001234567"
              [class.is-invalid]="celular?.invalid && celular?.touched">
            <div class="invalid-feedback" *ngIf="celular?.invalid && celular?.touched">
              <span *ngIf="celular?.errors?.['required']">El celular es requerido</span>
              <span *ngIf="celular?.errors?.['pattern']">Ingrese un número válido de 10 dígitos</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Información de Ubicación -->
      <div class="form-section">
        <div class="section-header">
          <i class="fas fa-map-marker-alt"></i>
          <h2>Información de Ubicación</h2>
        </div>
        
        <div class="form-grid">
          <div class="form-group full-width">
            <label for="direccion">Dirección *</label>
            <input 
              type="text" 
              id="direccion" 
              class="form-control" 
              formControlName="direccion"
              placeholder="Ej: Calle 123 # 45-67"
              [class.is-invalid]="direccion?.invalid && direccion?.touched">
            <div class="invalid-feedback" *ngIf="direccion?.invalid && direccion?.touched">
              La dirección es requerida
            </div>
          </div>

          <div class="form-group">
            <label for="ciudad">Ciudad *</label>
            <input 
              type="text" 
              id="ciudad" 
              class="form-control" 
              formControlName="ciudad"
              [class.is-invalid]="ciudad?.invalid && ciudad?.touched">
            <div class="invalid-feedback" *ngIf="ciudad?.invalid && ciudad?.touched">
              La ciudad es requerida
            </div>
          </div>

          <div class="form-group">
            <label for="departamento">Departamento</label>
            <select 
              id="departamento" 
              class="form-control" 
              formControlName="departamento">
              <option value="">Seleccionar...</option>
              <option *ngFor="let departamento of getDepartamentos()" [value]="departamento">
                {{ departamento }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="pais">País</label>
            <select 
              id="pais" 
              class="form-control" 
              formControlName="pais">
              <option value="">Seleccionar...</option>
              <option *ngFor="let pais of getPaises()" [value]="pais">
                {{ pais }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="codigoPostal">Código Postal</label>
            <input 
              type="text" 
              id="codigoPostal" 
              class="form-control" 
              formControlName="codigoPostal"
              placeholder="Ej: 110111">
          </div>
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancelarCambios()" [disabled]="guardando">
          <i class="fas fa-times"></i> Cancelar Cambios
        </button>
        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="perfilForm.invalid || guardando || !hayCambiosPendientes()">
          <i class="fas fa-save"></i> 
          <span *ngIf="!guardando">Guardar Cambios</span>
          <span *ngIf="guardando">Guardando...</span>
        </button>
      </div>
    </form>
  </div>
</div>