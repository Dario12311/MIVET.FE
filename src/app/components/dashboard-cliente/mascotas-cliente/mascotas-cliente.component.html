<div class="mascotas-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <button class="back-btn" (click)="volver()">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="header-text">
        <h1><i class="fas fa-paw"></i> Mis Mascotas</h1>
        <p>Gestiona la información de tus mascotas</p>
      </div>
      <button class="btn btn-primary" (click)="abrirModalNuevaMascota()">
        <i class="fas fa-plus"></i> Registrar Mascota
      </button>
    </div>
  </div>

  <!-- Indicador de carga -->
  <div *ngIf="cargando" class="loading-container">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p>Cargando mascotas...</p>
  </div>

  <!-- Estado vacío -->
  <div *ngIf="!cargando && mascotas.length === 0" class="empty-state">
    <i class="fas fa-paw fa-3x"></i>
    <h3>No tienes mascotas registradas</h3>
    <p>Registra tu primera mascota para comenzar a gestionar su información y citas</p>
    <button class="btn btn-primary" (click)="abrirModalNuevaMascota()">
      <i class="fas fa-plus"></i> Registrar Primera Mascota
    </button>
  </div>

  <!-- Grid de mascotas -->
  <div *ngIf="!cargando && mascotas.length > 0" class="mascotas-grid">
    <div *ngFor="let mascota of mascotas" class="mascota-card">
      <!-- Header de la tarjeta -->
      <div class="card-header">
        <div class="mascota-icon">
          <i [class]="getIconoEspecie(mascota.especie)"></i>
        </div>
        <div class="mascota-info">
          <h3>{{ mascota.nombre }}</h3>
          <p>{{ mascota.especie }} - {{ mascota.raza }}</p>
        </div>
        <div class="card-actions">
          <button class="action-btn" (click)="abrirModalEditarMascota(mascota)" title="Editar mascota">
            <i class="fas fa-edit"></i>
          </button>
        </div>
      </div>

      <!-- Información de la mascota -->
      <div class="card-body">
        <div class="info-grid">
          <div class="info-item">
            <i class="fas fa-calendar"></i>
            <span class="label">Edad:</span>
            <span class="value">{{ formatearEdad(mascota.edad) }}</span>
          </div>
          
          <div class="info-item">
            <i class="fas fa-venus-mars"></i>
            <span class="label">Género:</span>
            <span class="value">{{ mascota.genero === 'M' ? 'Macho' : 'Hembra' }}</span>
          </div>
          
          <div class="info-item">
            <i class="fas fa-heart-pulse"></i>
            <span class="label">Estado:</span>
            <span class="badge" [class]="'badge-' + getEstadoMascota(mascota.estado).clase">
              {{ getEstadoMascota(mascota.estado).texto }}
            </span>
          </div>
        </div>
      </div>

      <!-- Acciones de la tarjeta -->
      <div class="card-footer">
        <button class="btn btn-outline-primary btn-sm" (click)="verHistorialMascota(mascota)">
          <i class="fas fa-clipboard-list"></i>
          Historial
        </button>
        <button class="btn btn-outline-success btn-sm" (click)="agendarCitaMascota(mascota)">
          <i class="fas fa-calendar-plus"></i>
          Agendar Cita
        </button>
        <button class="btn btn-outline-info btn-sm" (click)="verCitasMascota(mascota)">
          <i class="fas fa-calendar-check"></i>
          Ver Citas
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal para nueva mascota -->
<div class="modal-backdrop" *ngIf="mostrarModalNuevaMascota" (click)="cerrarModalNuevaMascota()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-paw"></i> Registrar Nueva Mascota</h3>
      <button type="button" class="btn-close" (click)="cerrarModalNuevaMascota()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label for="nombre">Nombre *</label>
          <input 
            type="text" 
            id="nombre" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.nombre"
            placeholder="Nombre de la mascota">
        </div>

        <div class="form-group">
          <label for="especie">Especie *</label>
          <select 
            id="especie" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.especie">
            <option value="">Seleccionar especie...</option>
            <option *ngFor="let especie of getEspeciesDisponibles()" [value]="especie">
              {{ especie }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="raza">Raza *</label>
          <input 
            type="text" 
            id="raza" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.raza"
            placeholder="Raza de la mascota">
        </div>

        <div class="form-group">
          <label for="edad">Edad (años) *</label>
          <input 
            type="number" 
            id="edad" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.edad"
            min="0"
            step="0.1"
            placeholder="0">
        </div>

        <div class="form-group full-width">
          <label for="genero">Género *</label>
          <select 
            id="genero" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.genero">
            <option value="">Seleccionar género...</option>
            <option *ngFor="let genero of getGenerosDisponibles()" [value]="genero.valor">
              {{ genero.texto }}
            </option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalNuevaMascota()">
        Cancelar
      </button>
      <button class="btn btn-primary" (click)="registrarMascota()">
        <i class="fas fa-save"></i>
        Registrar Mascota
      </button>
    </div>
  </div>
</div>

<!-- Modal para editar mascota -->
<div class="modal-backdrop" *ngIf="mostrarModalEditarMascota" (click)="cerrarModalEditarMascota()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-edit"></i> Editar Mascota</h3>
      <button type="button" class="btn-close" (click)="cerrarModalEditarMascota()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label for="editNombre">Nombre *</label>
          <input 
            type="text" 
            id="editNombre" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.nombre"
            placeholder="Nombre de la mascota">
        </div>

        <div class="form-group">
          <label for="editEspecie">Especie *</label>
          <select 
            id="editEspecie" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.especie">
            <option value="">Seleccionar especie...</option>
            <option *ngFor="let especie of getEspeciesDisponibles()" [value]="especie">
              {{ especie }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="editRaza">Raza *</label>
          <input 
            type="text" 
            id="editRaza" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.raza"
            placeholder="Raza de la mascota">
        </div>

        <div class="form-group">
          <label for="editEdad">Edad (años) *</label>
          <input 
            type="number" 
            id="editEdad" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.edad"
            min="0"
            step="0.1"
            placeholder="0">
        </div>

        <div class="form-group">
          <label for="editGenero">Género *</label>
          <select 
            id="editGenero" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.genero">
            <option value="">Seleccionar género...</option>
            <option *ngFor="let genero of getGenerosDisponibles()" [value]="genero.valor">
              {{ genero.texto }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="editEstado">Estado</label>
          <select 
            id="editEstado" 
            class="form-control" 
            [(ngModel)]="nuevaMascota.estado">
            <option value="A">Activa</option>
            <option value="I">Inactiva</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalEditarMascota()">
        Cancelar
      </button>
      <button class="btn btn-primary" (click)="actualizarMascota()">
        <i class="fas fa-save"></i>
        Guardar Cambios
      </button>
    </div>
  </div>
</div>